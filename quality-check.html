<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ–≤–µ—Ä–æ—á–Ω–∞—è –ø–∞–Ω–µ–ª—å</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            line-height: 1.4;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: #007AFF;
            color: white;
            padding: 15px 20px;
            font-size: 18px;
            font-weight: 600;
        }

        .form-container {
            padding: 20px;
        }

        .form-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            gap: 15px;
        }

        .form-row input[type="date"] {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-row select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            min-width: 200px;
            font-size: 14px;
        }

        .indicators-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin: 20px 0;
        }

        .indicator-row {
            display: grid;
            grid-template-columns: auto 1fr auto auto auto auto auto;
            gap: 15px;
            align-items: center;
            padding: 12px;
            background: #fafafa;
            border-radius: 6px;
            border-left: 4px solid #007AFF;
            font-size: 14px;
        }

        .indicator-checkbox {
            width: 20px;
            height: 20px;
            accent-color: #007AFF;
        }

        .indicator-text {
            font-weight: 500;
            color: #333;
        }

        .indicator-field {
            width: 100px;
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
        }

        .indicator-field:focus {
            outline: none;
            border-color: #007AFF;
            box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.2);
        }

        .copy-link {
            background: #f0f0f0;
            border: none;
            padding: 6px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            color: #666;
        }

        .copy-link:hover {
            background: #e0e0e0;
        }

        .btn-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            min-width: 150px;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #007AFF;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }

        .btn-danger {
            background: #FF3B30;
            color: white;
        }

        .btn-danger:hover {
            background: #d32f2f;
            transform: translateY(-1px);
        }

        .results-table {
            margin-top: 30px;
            border-top: 2px solid #eee;
            padding-top: 20px;
        }

        .table-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        th, td {
            padding: 8px 10px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .score-high { color: #28a745; font-weight: 600; }
        .score-medium { color: #ffc107; font-weight: 600; }
        .score-low { color: #dc3545; font-weight: 600; }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 6px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success { background: #28a745; }
        .notification.error { background: #dc3545; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            –ü—Ä–æ–≤–µ—Ä–æ—á–Ω–∞—è –ø–∞–Ω–µ–ª—å (—Ä—É—á–Ω–æ–π –≤–≤–æ–¥ –≤ –ø—Ä–æ—Å–ª–æ–π–∫—É)
        </div>
        
        <div class="form-container">
            <div class="form-row">
                <input type="date" id="check-date" />
                <select id="manager-select">
                    <option value="">–ú–µ–Ω–µ–¥–∂–µ—Ä</option>
                    <option value="–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤">–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤</option>
                    <option value="–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞">–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞</option>
                    <option value="–ê–ª–µ–∫—Å–µ–π –ö–æ–∑–ª–æ–≤">–ê–ª–µ–∫—Å–µ–π –ö–æ–∑–ª–æ–≤</option>
                    <option value="–ï–ª–µ–Ω–∞ –†–æ–º–∞–Ω–æ–≤–∞">–ï–ª–µ–Ω–∞ –†–æ–º–∞–Ω–æ–≤–∞</option>
                </select>
                <select id="department-select">
                    <option value="op">–û–ü</option>
                    <option value="prod">–ü—Ä–æ–¥–∞–∫—à–Ω</option>
                </select>
                <select id="month-select">
                    <option value="">–ê–ø—Ä–µ–ª—å</option>
                    <option value="–Ø–Ω–≤–∞—Ä—å">–Ø–Ω–≤–∞—Ä—å</option>
                    <option value="–§–µ–≤—Ä–∞–ª—å">–§–µ–≤—Ä–∞–ª—å</option>
                    <option value="–ú–∞—Ä—Ç">–ú–∞—Ä—Ç</option>
                    <option value="–ê–ø—Ä–µ–ª—å">–ê–ø—Ä–µ–ª—å</option>
                    <option value="–ú–∞–π">–ú–∞–π</option>
                    <option value="–ò—é–Ω—å">–ò—é–Ω—å</option>
                    <option value="–ò—é–ª—å">–ò—é–ª—å</option>
                    <option value="–ê–≤–≥—É—Å—Ç">–ê–≤–≥—É—Å—Ç</option>
                </select>
            </div>

            <div class="indicators-grid" id="indicators-container">
                <!-- Indicators will be loaded here -->
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="addRecord()">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
                <button class="btn btn-danger" onclick="clearForm()">–û—á–∏—Å—Ç–∏—Ç—å —Ä—É—á–Ω—ã–µ –∑–∞–ø–∏—Å–∏</button>
            </div>

            <div class="results-table">
                <div class="table-title">–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫</div>
                <table id="results-table">
                    <thead>
                        <tr>
                            <th>–î–∞—Ç–∞</th>
                            <th>–ú–µ–Ω–µ–¥–∂–µ—Ä</th>
                            <th>–û—Ç–¥–µ–ª</th>
                            <th>–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å</th>
                            <th>–ë–∞–ª–ª</th>
                            <th>–°—Å—ã–ª–∫–∞</th>
                            <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        // –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –¥–ª—è –û–ü
        const OP_INDICATORS = [
            '–†–∞–±–æ—Ç–∞ —Å –ö–≠–í',
            '–°—Ä–æ–∫–∏',
            '–û–±—â–µ–Ω–∏–µ —Å –∫–ª–∏–µ–Ω—Ç–æ–º',
            '–ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è CRM'
        ];

        // –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –¥–ª—è –ü—Ä–æ–¥–∞–∫—à–Ω
        const PROD_INDICATORS = [
            '–ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å —Å—Ç–∞–¥–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ –∫–∞–Ω–±–∞–Ω—É',
            '–í–µ—Ä–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ –≤ —Å–¥–µ–ª–∫—É',
            '–ó–∞–ø–æ–ª–Ω–µ–Ω—ã –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –≤ –ë–∏—Ç—Ä–∏–∫—Å',
            '–¢–ó –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–æ –≤ —Å–¥–µ–ª–∫—É —Ñ–∞–π–ª–æ–º –≤ –ë–∏—Ç—Ä–∏–∫—Å',
            '–í —Å–¥–µ–ª–∫–µ –µ—Å—Ç—å –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞',
            '–ù–∞–ª–∏—á–∏–µ –º–µ—Ä—Ç–≤—ã—Ö –ª–∏–Ω–∏–π/–¥—É–±–ª—è–∂ –Ω–µ–Ω—É–∂–Ω—ã—Ö –ª–∏–Ω–∏–π',
            '–û—Ç–≤–µ—Ç –≤ —á–∞—Ç–µ –≤ —Ç–µ—á–µ–Ω–∏–µ 45-—Ç–∏ –º–∏–Ω—É—Ç –≤ –ª–∏–Ω–∏–∏ —Å –∫–ª–∏–µ–Ω—Ç–æ–º',
            '–ü–æ–∑–¥–æ—Ä–æ–≤–∞–ª—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–∞—Å–∞–Ω–∏–∏',
            '–î–æ–±—Ä–æ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å',
            '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –∑–∞–ø—Ä–µ—Ç–Ω—ã–µ —Å–ª–æ–≤–∞ –≤ –¥–∏–∞–ª–æ–≥–µ',
            '–°–æ–æ–±—â–∏–ª —á—Ç–æ 1 –ø–∞–∫–µ—Ç –ø—Ä–∞–≤–æ–∫ –¥–∞–ª–µ–µ –ø–ª–∞—Ç–Ω–æ',
            '–°–æ–æ–±—â–∏–ª 2 –º–µ—Å—è—Ü–∞ –æ–±–ª–∞—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤',
            '–†–∞–±–æ—Ç–∞ —Å –¢–ó, —Ç–æ—á–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞',
            '–û–±—å—è—Å–Ω–∏–ª –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π —Ç–µ—Ä–º–∏–Ω –∏–∑ —Å–ª–æ–≤–∞—Ä—è',
            '–°–¥–µ–ª–∞–Ω—ã 3 –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –∑–∞–±–æ—Ä–µ —Ç–æ–≤–∞—Ä–æ–≤',
            '–•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ 5+25 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π',
            '–û—Ç–æ—Å–ª–∞–Ω –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞ –¥–ª—è –∑–∞–±–æ—Ä–∞',
            '–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–∞–º—è—Ç–∫–∞ –ø–æ –∑–∞–±–æ—Ä—É',
            '–ü–æ–ø—Ä–æ—Å–∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤',
            '–û—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –ª–∏–Ω–∏–∏ –±–µ–∑ –æ—Ç–≤–µ—Ç–∞ –≤ –∫–æ–Ω—Ü–µ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è',
            '–ó–≤–æ–Ω–æ–∫ —Å –∫–ª–∏–µ–Ω—Ç–æ–º –∑–∞—Ä–µ–∑—é–º–∏—Ä–æ–≤–∞–Ω'
        ];

        let currentData = [];

        function initForm() {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
            document.getElementById('check-date').value = new Date().toISOString().split('T')[0];
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –¥–ª—è –û–ü –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            loadIndicators('op');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage
            loadData();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É
            updateTable();

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–¥–µ–ª–∞
            document.getElementById('department-select').addEventListener('change', function() {
                loadIndicators(this.value);
            });
        }

        function loadIndicators(department) {
            const container = document.getElementById('indicators-container');
            const indicators = department === 'op' ? OP_INDICATORS : PROD_INDICATORS;
            
            container.innerHTML = indicators.map((indicator, index) => `
                <div class="indicator-row">
                    <input type="checkbox" class="indicator-checkbox" id="check-${index}">
                    <div class="indicator-text">${indicator}</div>
                    <input type="text" class="indicator-field" placeholder="—Å—Å—ã–ª–∫–∞" id="link-${index}">
                    <input type="text" class="indicator-field" placeholder="–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" id="comment-${index}">
                    <input type="text" class="indicator-field" placeholder="ID —Å–¥–µ–ª–∫–∏" id="deal-${index}">
                    <button class="copy-link" onclick="copyLink(${index})">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
                    <div style="display: flex; gap: 5px;">
                        <button class="btn btn-primary" style="padding: 4px 8px; font-size: 12px;" onclick="addSingle(${index})">–î–æ–±–∞–≤–∏—Ç—å</button>
                        <button class="btn btn-danger" style="padding: 4px 8px; font-size: 12px;" onclick="removeSingle(${index})">–û—á–∏—Å—Ç–∏—Ç—å</button>
                    </div>
                </div>
            `).join('');
        }

        function addRecord() {
            const date = document.getElementById('check-date').value;
            const manager = document.getElementById('manager-select').value;
            const department = document.getElementById('department-select').value;
            const month = document.getElementById('month-select').value;

            if (!date || !manager || !department) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞—Ç—É, –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∏ –æ—Ç–¥–µ–ª', 'error');
                return;
            }

            const indicators = document.querySelectorAll('.indicator-row');
            let addedCount = 0;

            indicators.forEach((row, index) => {
                const checkbox = document.getElementById(`check-${index}`);
                if (checkbox.checked) {
                    const indicatorText = row.querySelector('.indicator-text').textContent;
                    const link = document.getElementById(`link-${index}`).value;
                    const comment = document.getElementById(`comment-${index}`).value;
                    const dealId = document.getElementById(`deal-${index}`).value;

                    const record = {
                        id: Date.now() + index,
                        date: date,
                        manager: manager,
                        department: department === 'op' ? '–û–ü' : '–ü—Ä–æ–¥–∞–∫—à–Ω',
                        indicator: indicatorText,
                        score: 100, // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–π–¥–µ–Ω–∞
                        link: link,
                        comment: comment,
                        dealId: dealId,
                        month: month || new Date().toLocaleDateString('ru-RU', { month: 'long' }),
                        timestamp: Date.now()
                    };

                    currentData.unshift(record);
                    addedCount++;
                }
            });

            if (addedCount > 0) {
                saveData();
                updateTable();
                showNotification(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${addedCount} –∑–∞–ø–∏—Å–µ–π`, 'success');
                clearCheckedItems();
            } else {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å', 'error');
            }
        }

        function addSingle(index) {
            const date = document.getElementById('check-date').value;
            const manager = document.getElementById('manager-select').value;
            const department = document.getElementById('department-select').value;
            const month = document.getElementById('month-select').value;

            if (!date || !manager || !department) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞—Ç—É, –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∏ –æ—Ç–¥–µ–ª', 'error');
                return;
            }

            const indicatorText = document.querySelector(`#indicators-container .indicator-row:nth-child(${index + 1}) .indicator-text`).textContent;
            const link = document.getElementById(`link-${index}`).value;
            const comment = document.getElementById(`comment-${index}`).value;
            const dealId = document.getElementById(`deal-${index}`).value;

            const record = {
                id: Date.now() + index,
                date: date,
                manager: manager,
                department: department === 'op' ? '–û–ü' : '–ü—Ä–æ–¥–∞–∫—à–Ω',
                indicator: indicatorText,
                score: 100,
                link: link,
                comment: comment,
                dealId: dealId,
                month: month || new Date().toLocaleDateString('ru-RU', { month: 'long' }),
                timestamp: Date.now()
            };

            currentData.unshift(record);
            saveData();
            updateTable();
            showNotification('–ó–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞', 'success');
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è
            document.getElementById(`link-${index}`).value = '';
            document.getElementById(`comment-${index}`).value = '';
            document.getElementById(`deal-${index}`).value = '';
            document.getElementById(`check-${index}`).checked = false;
        }

        function removeSingle(index) {
            document.getElementById(`link-${index}`).value = '';
            document.getElementById(`comment-${index}`).value = '';
            document.getElementById(`deal-${index}`).value = '';
            document.getElementById(`check-${index}`).checked = false;
        }

        function copyLink(index) {
            const link = document.getElementById(`link-${index}`).value;
            if (link) {
                navigator.clipboard.writeText(link).then(() => {
                    showNotification('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞', 'success');
                });
            }
        }

        function clearForm() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ä—É—á–Ω—ã–µ –∑–∞–ø–∏—Å–∏? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!')) {
                currentData = [];
                saveData();
                updateTable();
                clearCheckedItems();
                showNotification('–í—Å–µ –∑–∞–ø–∏—Å–∏ –æ—á–∏—â–µ–Ω—ã', 'success');
            }
        }

        function clearCheckedItems() {
            document.querySelectorAll('.indicator-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            document.querySelectorAll('.indicator-field').forEach(field => {
                field.value = '';
            });
        }

        function updateTable() {
            const tbody = document.querySelector('#results-table tbody');
            tbody.innerHTML = currentData.slice(0, 100).map(record => `
                <tr>
                    <td>${record.date}</td>
                    <td>${record.manager}</td>
                    <td>${record.department}</td>
                    <td>${record.indicator}</td>
                    <td class="score-high">${record.score}%</td>
                    <td>${record.link ? `<a href="${record.link}" target="_blank">üîó</a>` : ''}</td>
                    <td>${record.comment || ''}</td>
                </tr>
            `).join('');
        }

        function saveData() {
            localStorage.setItem('qualityCheckData', JSON.stringify(currentData));
        }

        function loadData() {
            const saved = localStorage.getItem('qualityCheckData');
            currentData = saved ? JSON.parse(saved) : [];
        }

        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', initForm);
    </script>
</body>
</html>